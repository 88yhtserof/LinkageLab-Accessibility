# 이슈1: 임의 탐색 불가

## 개요

‘임의 탐색 불가 이슈’에 대해 소개한 후, 개발팀과 접근성 팀의 논의를 바탕으로 이슈 상황을 재현했습니다. 그리고 이슈 개선 작업 과정과 결과를 정리했으며, 작업 결과를 바탕으로 의견을 제안했습니다.

<br>


## 작업 상세


### 구현 방법

임의 탐색(2)을 보장하기 위해 `ZStack`을 사용해 컴포넌트들을 상하위 관계로 종속하지 않고 동일한 계층에 두어 배치했습니다. 
순차 탐색(1)의 순서를 보장하기 위해 `accessibilitySortPriotity`를 사용해 초점 순서를 지정했습니다.

*하단 구현 결과 화면 참조*


<br>


### 구현 결과 화면

1. 순차 탐색의 순서 보장 시 임의 탐색 불가
    
    초점 이동 경로: 배경(외부) → 예상 금액(내부)
    
| 순차 탐색의 순서 보장 구현 화면 |
| ----- |
| <img src = "https://github.com/user-attachments/assets/bee25493-9b42-44b8-af87-45279d970133" width = 240 height = 540> | 


    

1. 임의 탐색을 제공하는 경우 순차탐색 불가 
    
    초점 이동 경로: 예상 금액(내부) → 배경(외부)


| 임의 탐색 제공 구현 화면 |
| ----- |
| <img src = "https://github.com/user-attachments/assets/6b8c7d58-56d2-42e1-aa94-0b45efbee771" width = 240 height = 540> |


 
<br>
   

## 작업 결과

### 임의 탐색 구현 결과

임의 탐색을 구현하기 위해 `ZStack`을 사용해 뷰를 상하위 관계로 종속하지 않고 동일한 단계에 배치하는 형식으로 구성했습니다. 그리고 **배경**과 **예상 금액** 을 제외한 다른 뷰들은 `accessibilityHidden` 으로 초점을 숨겨 사용자가 두 곳에만 접근할 수 있도록 구현했습니다. 

위와 같은 방식으로 순차 탐색과 임의 탐색을 모두 제공하는데 성공했지만, 순차 탐색의 경우 올바르지 않은 접근 순서를 갖게 되어 또 다른 이슈가 생겼습니다.

> 예상 금액(내부) → 배경(외부)
> 

이를 개선하기 위해 `accessibilitySortPriority` 를 사용해 초점의 우선순위를 설정했습니다. 하지만 초점의 우선 순위를 설정하면 순차탐색은 올바른 순서로  이동하지만 임의탐색을 제공할 수 없다는 문제가 발생했습니다.

<br>

### 우선순위 설정이 임의 탐색에 미치는 영향

우선 순위 설정이 임의 탐색에 영향을 미치는 이유는 화면이 컴포넌트의 계층 구조로 구성되기 때문입니다.

임의 탐색이 가능했던 이유는 배경과 예상 금액  컴포넌트를 동일한 계층에 상하위 관계 없이 배치했기 때문입니다. 하지만 화면은 많은 컴포넌트들이 쌓여져 만들어지므로, 프로그래밍상 두 컴포넌트를 동일한 계층에 위치시키더라도 하나의 컴포넌트가 다른 컴포넌트에 가려지는 상황이 발생합니다. 이와 같은 계층 구조의 변화가 임의 탐색 기능에 영향을 미칩니다.

| 화면 구성 |
| ----- |
| <img src = "https://github.com/user-attachments/assets/44eaa2dc-da45-4fcd-bd44-bb67777760dc" width = 540 height = 240> |


<br>

### 우선 순위 설정과 임의 탐색에 미치는 영향 분석

<br>

### 초점 이동 순서의 변화와 임의 탐색 영향

임의 탐색 화면에서 초점 이동 순서를 살펴보면, 기본적으로 **[ 예상 금액(내부) → 배경(외부) ]** 순으로 이동합니다. 그러나 동일한 구현체에서 두 컴포넌트의 배치 순서만 변경하면, 예상 금액 컴포넌트는 배경 컴포넌트에 가려져 임의 탐색이 불가능해지며, 초점 이동 순서도 **[ 배경(외부) → 예상 금액(내부) ]** 로 바뀌게 됩니다.



<br>

### 순차 탐색 우선순위와 임의 탐색의 관계

순차 탐색에서 우선순위를 지정하여 초점 순서를 보장하는 경우, 기본 구현에서는  **[ 배경(외부, 1순위) → 예상 금액(내부, 2순위) ]**  순으로 초점이 이동합니다. 그러나 임의 탐색에서는 예상 금액 컴포넌트에 접근이 불가능합니다.

이 문제는 배경 컴포넌트가 예상 금액 컴포넌트를 가리기 때문에 발생합니다. 실제로 배경 컴포넌트의 크기를 줄이면 임의 탐색도 가능해지며, 이는 배경 컴포넌트가 예상 금액 컴포넌트를 가리는 문제였음을 확인할 수 있습니다.


<br>

### accessibilitySortPriority 속성에 의한 초점 우선순위 설정

위 네 가지 경우를 종합해 보면, `accessibilitySortPriority` 속성을 사용하여 초점의 우선순위를 설정하는 경우, 예상 금액과 배경 화면 컴포넌트의 배치 순서가 시스템 내에서 조정되는 것으로 추정됩니다.

따라서 배경 컴포넌트가 상위에 배치되면 예상 금액 컴포넌트가 가려져 임의 탐색이 불가능해지며, 반대로 예상 금액 컴포넌트가 상위에 배치되면 임의 탐색을 통해 예상 금액에 접근할 수 있게 됩니다.

<br>

### 대체 방안 시도 및 결과

> 터치 영역에 따른 초점 시도
> 

터치된 영역을 감지하여 예상 금액 컴포넌트로 초점을 이동시키는 방법을 시도했습니다. 

**VoiceOver가 비활성화 된 경우,** 시스템은 터치된 지점을 좌표로 인식하여 사용자와 기기 간 상호작용을 가능하게 합니다. 이러한 방식으로 터치 지점에 따라 원하는 작업을 구현할 수 있습니다. 
하지만 **VoiceOver가 활성화된 경우,** 시스템에서는 초점을 컴포넌트(또는 컨테이너) 단위로 탐색합니다. 따라서 터치 지점에 대한 좌표를 제공해주지 않습니다.

따라서 터치 영역을 감지하여 임의로 초점을 설정하는 방식을 불가능합니다.


| VoiceOver가 비활성화된 경우, 터치 지점을 인식하여 좌표로 제공하는 코드 |
| ----- |
| <img src = "https://github.com/user-attachments/assets/53802ae8-8d6b-4f16-8ba0-69d5326b322f" width = 540 height = 500> |


<br>

### 작업 결과에 따른 제안

**순서가 보장되어 올바르게 순차 탐색되는 현재 상태를 유지**하는 것이 바람직하다고 판단됩니다.

순차탐색은 사용자가 모든 컴포넌트를 순차적으로 탐색할 수 있는 가장 기본적인 방법이며, 접근성 측면에서 우선적으로 제공되어야 하는 탐색 방법입니다.  
반면 임의 탐색의 경우 사용자가 특정 컴포넌트를 빠르게 찾거나 대략적인 구조 파악하는데 유용하지만, 전체 컴포넌트를 순차적으로 탐색하는데 적합하지 않습니다. 따라서 순서가 보장된 순차탐색과 임의탐색 중 하나를 선택해야 한다면 **순서 보장 순차탐색**을 선택하는 것이 좋을 것 같습니다.

그럼에도 불구하고 가장 이상적인 방식은 목적이 다른 컴포넌트들을 하나의 컨테이너에 두지 않는 것입니다. 
해당 서비스의 다른 화면에서는 아래와 같이 분리되어 배치되어 있습니다. 이처럼 각 컴포넌트를 별도의 컨테이더로 구분하면 순서 보장 순차탐색/임의탐색 동시에 제공할 수 있습니다. 이는 가장 효율적이고 접근성 친화적인 화면 구성 방식이라 할 수 있습니다.


<br>

## 종합 의견


‘임의 탐색 불가 이슈’는 화면 UI 구성에서 컴포넌트들의 상하위 계층 구조로 인해 발생한 문제입니다.

이 문제를 해결하기 위해 `ZStack`을 사용해 상하위 계층 구조 없이 컴포넌트를 동일 계층에 배치했으며 `accessibilitySortPriority` 속성을 사용하여 컴포넌트의 초점 우선 순위를 설정했습니다. 그러나 컴포넌트 우선순위를 설정하면 시스템 상 컴포넌트들의 계층 구조가 자동으로 설정되며 임의 탐색이 불가능한 이슈가 다시 발생했습니다. 결국 컴포넌트의 계층 구조를 고려할 때, **순서가 보장된 순차 탐색**과 **임의 탐색** 중 하나를 선택해야했습니다.

순차탐색은 사용자가 모든 컴포넌트를 순차적으로 탐색할 수 있도록 보장하는 가장 기본적인 탐색 방식입니다. 따라서 **순서가 보장된 순차 탐색**이 가능한 현재 상황을 유지하는것이 바람직하다고 보입니다. 

그럼에도 불구하고 가장 이상적인 해결책은 **목적이 다른 컴포넌트들을 하나의 컨테이너에 배치하지 않는 것**입니다. 각 컴포넌트를 별도의 컨테이너에 배치함으로써 순차 탐색과 임의 탐색을 모두 제공할 수 있습니다.
